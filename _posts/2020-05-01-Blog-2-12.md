---
title: Blog 2-12
published: true
---

Today is the day. Today is the day of the last blog due for CIT Senior Design! I remember when these blogs were assigned, and how I thought they would go. I look back on them fondly, as they pushed me to learn more and more each week.

I am returning to work with the Raspberry Pi for the last blog. It continues to enable me to do various projects, and I would recommend it to anyone who wants to learn more or accomplish a light project. We will be configuring the Pi to act as a wireless access point.

## Required items

1. Raspberry Pi 3 (WiFi enabled)
2. Micro SD card (OS loaded)
3. PSU
4. Network Connection to the Pi (Ethernet)

## Required packages

For this project, we will utilize hostapd and dnsmasq. Install them as such:

```
sudo apt-get update && upgrade
sudo apt-get install hostapd dnsmasq
```

Additionally, before configuring these systems, we will need to stop them from running:

```
sudo systemctl stop hostapd
sudo systemctl stop dnsmasq
```

## Edit The dhcpcd configuration file

We will need to assign our Pi access point an IP, as well as let it take control of the wlan0 interface.

```
sudo nano /etc/dhcpcd.conf
```

It should have this added to the bottom:

```
interface wlan0
    static ip_address=192.168.210.1/24
    nohook wpa_supplicant
```

Save and quit (Ctrl X, then accept with Y), then reload the service:

```
sudo systemctl restart dhcpcp
```

## Edit the hostapd configuration file

Let's enter the file to set how the device interacts with the wlan0 device.

```
sudo nano /etc/hostapd.conf
```

Find the 'ssid=' and 'wpa_passphrase=' lines, and input the information to access your wireless network.

Now we will tell hostapd where to read the configuration file from. Open the file:

```
sudo nano /etc/default/hostapd
```

Replace:

```
'#DAEMON_CONF=""
```

with:

```
DAEMON_CONF="/etc/hostapd/hostapd.conf"
```

Now for the second configuration file direction, open it here:

```
sudo nano /etc/init.d/hostapd
```

Replace:

```
DAEMON_CONF=
```

with:

```
DAEMON_CONF=/etc/hostapd/hostapd.conf
```

## Set up DNSMasq

Let's get rid of the old configuration and start from scratch:

```
sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig
sudo nano /etc/dnsmasq.conf
```

Add the following lines to the dnsmasq.conf file, which tells dnsmasq how to handle connections that come through the network interface. 

```
interface=wlan0
server=8.8.8.8 #Google DNS
dhcp-range=192.168.210.50,192.168.210.150,12h #12 hour lease
```

Then, we need access to sysctl.conf, so we can enable the first line.

```
sudo nano /etc/sysctl.conf
```

Remove the '#' from the first line. It should look like the following after:

```
net.ipv4.ip_forward=1
```

Activat it with the following line:

```
sudo sh -c "echo 1 > /proc/sys/net/ipv4/ip_forward"
```

## Configure NAT between wlan0 and eth0

Use the following to forward data between the two interfaces (your Pi and the wireless router):

```
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

Save the new rules:

```
sudo sh -c "iptables-save > /etc/iptables.ipv4.nat"
```

Load the file when the system boots so it works every time, by editing the rc.local file:

```
sudo nano /etc/rc.local
```

Then add in the following line of code just before the 'exit 0' part, which should be at the end:

```
iptables-restore < /etc/iptables.ipv4.nat
```

## Restart and test!

Start and enable the services in systemctl:

```
sudo systemctl unmask hostapd
sudo systemctl enable hostapd
sudo systemctl start hostapd
sudo service dnsmasq start
sudo reboot
```

Congratulations on expanding the range of your wireless network.

As always, thanks for reading! This is me, signing off.

Daniel